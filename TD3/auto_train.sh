#!/bin/bash
###############################################################################
# run_td3.sh – 批量启动 train_velodyne_td3_graph.py
# param10 依次取 1e-5, 2e-5 … 9e-5, 1e-4, 2e-4 … 9e-4, 1e-3 …
###############################################################################

# =============================== 固定参数区 ================================ #
param1=0.05
param2=40
param3=7000
param4=121             # 循环尾部自增 1
param5=740
timeout_duration=20000 # 20 000 s ≈ 5.6 h
param6=0
param7=0
param8=600             # 500
param9=-0.0003
# ----------------------- 由脚本自动递增的参数 ------------------------------ #
start_exp=-3           # 初始指数 (10⁻⁵)
num_executions=50      # 迭代次数，可按需调整
# ========================================================================== #

for (( i=5; i<num_executions; i++ ))
do
    # -------------------------- 计算 param10 ------------------------------ #
    mantissa=$(( (i % 9) + 1 ))        # 1~9 循环
    exp=$(( start_exp + i / 9 ))       # 每 9 轮指数 +1
    param10="${mantissa}e${exp}"       # 形如 3e-5、7e-4
    # --------------------------------------------------------------------- #

    echo "执行 $(printf '%02d' $i): python3 train_velodyne_td3_graph.py" \
         "$param1 $param2 $param3 $param4 $param5 $param6 $param7 $param8 $param9 $param10"

    timeout "$timeout_duration" \
            python3 train_velodyne_td3_graph.py \
            $param1 $param2 $param3 $param4 $param5 $param6 $param7 $param8 $param9 $param10

    # -------------------------- 循环内自增参数 ---------------------------- #
   # param4=$((param4 + 1))             # 下次循环更新 param4
    # --------------------------------------------------------------------- #

    # -------------------------- 关机脚本调用 ------------------------------ #
    echo "执行 shutdown.sh..."
    echo ' ' | sudo -S ./shutdown.sh
    echo "等待 30 秒..."
    sleep 30
    # --------------------------------------------------------------------- #
done
